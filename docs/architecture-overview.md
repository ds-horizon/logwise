# Architecture Overview

**Log-Central** is a centralized and scalable log processing and viewing system designed to handle high-volume log data efficiently.  
It provides an end-to-end pipeline for log ingestion, transformation, storage, and viewing using modern open-source technologies.


## Architecture Diagram

![Log-Central Architecture](./architecture-diagram.png)


## Components

### **1. [Vector](/components/vector)**

- Serves as the **entry point** for log ingestion from multiple sources.  
- Performs:
  - **Log enhancement:** Adds metadata and enriches messages.
  - **Key normalization:** Removes problematic keys for compatibility.
  - **Format conversion:** Converts logs into **protobuf** for standardization.
  - **Compression:** Uses **protobuf** format to reduce bandwidth and storage usage.
- Sends processed logs to **Kafka** for ingestion and buffering.

---

### **2. [Kafka](/components/kafka)**

- Provides a **high-throughput**, **fault-tolerant**, and **scalable** log ingestion layer.  
- Vector dynamically creates **Kafka topics** using tags:
  - `type`
  - `env`
  - `service_name`
- Enables decoupled, delayed, or batched log processing to support downstream consumers like Spark.


---

### **3. [Kafka Manager](/components/kafka-manager)**

- Responsible for **monitoring Kafka cluster health** and **performance**.  
- Offers **APIs** used by the **Orchestrator Service** for:
  - Scaling partitions automatically based on message rate.
  - Balancing load across Kafka brokers.
- Ensures continuous high availability of Kafka topics and data streams.


---

### **4. Apache Spark**

- Consumes raw logs from Kafka and transforms them into **Parquet** format for:
  - Efficient compression.
  - Faster queries and optimized data scanning.
- Writes output into **Amazon S3** in **Hive-compatible directory structure** using this path pattern:
  ```
  env/service_name/year/month/day/hour/minute
  ```
- **Auto-scales** processing based on previous data volume.
- The **Orchestrator Service** manages Spark scaling and monitors job health.

---

### **5. Grafana**

- Acts as the **viewing and exploration** layer for logs.
- Displays processed logs in **table format** for easy searching and filtering.
- Enables **custom dashboards** and **interactive filters**.
- Dropdown filters are populated using **metadata** generated by the **Orchestrator Service** from source tags.

---

### **6. Orchestrator Service**

- The **central control component** that automates and maintains the overall system state.
- Performs several background operations:
  - **Spark Monitoring:** Keeps Spark drivers healthy and restarts them if needed.
  - **Cleanup:** Removes compacted Spark output files periodically to manage storage.
  - **Kafka Scaling:** Automatically increases Kafka partitions as log volume grows.
  - **Dynamic Spark Scaling:** Adjusts Spark cluster size dynamically based on input rate and service load.
  - **Metadata Management:** Generates metadata used by Grafana and enforces **log retention policies** on S3 for archival.
- Ensures consistent, automated orchestration across all components.


## Key Advantages

- Fully **scalable** and **automated** architecture.
- Supports **real-time ingestion** and **batch transformation**.
- Uses **S3** for cost-efficient, durable log storage.
- Integrates seamlessly with **Grafana** for log viewing and analytics.
- Provides **dynamic scaling** for both Kafka and Spark components through the Orchestrator Service.


## Summary

**Log-Central** delivers a comprehensive and automated solution for log aggregation, processing, and viewing.  
By leveraging **Vector**, **Kafka**, **Apache Spark**, **Grafana**, and the **Orchestrator Service**, it ensures reliability, scalability, and visibility across distributed systems while keeping operational overhead minimal.
